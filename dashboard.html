<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard IoT Pro - DHT11</title>

<script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">

<style>
:root {
  --primary: #00b4d8;
  --bg: #0d0d0d;
  --fg: #fff;
  --card: #141414;
  --accent: #222;
  --success: #06d6a0;
  --error: #f94144;
  --alert-temp: #f8961e;
  --alert-hum: #f3722c;
}
[data-theme="light"] {
  --bg: #f8f9fa;
  --fg: #111;
  --card: #fff;
  --accent: #e5e5e5;
}

*{margin:0;padding:0;box-sizing:border-box;font-family:'Poppins',sans-serif;}
body{background:var(--bg);color:var(--fg);min-height:100vh;transition:0.4s;}
header{background:var(--card);padding:15px 30px;display:flex;justify-content:space-between;align-items:center;box-shadow:0 4px 10px rgba(0,0,0,0.4);}
header h1{color:var(--primary);font-size:1.5rem;}
.btn{background:var(--primary);color:#fff;border:none;padding:10px 18px;border-radius:10px;font-weight:600;cursor:pointer;transition:0.3s;}
.btn:hover{opacity:0.85;}
.theme-btn{background:transparent;border:none;color:var(--primary);font-size:1.4rem;cursor:pointer;}
.main{padding:24px;display:grid;gap:20px;grid-template-columns:repeat(auto-fit,minmax(350px,1fr));}
.card{background:var(--card);border-radius:16px;padding:20px;box-shadow:0 0 15px rgba(0,0,0,0.3);transition:0.3s;}
.card:hover{transform:translateY(-4px);}
.card h2{color:var(--primary);margin-bottom:10px;font-size:1.1rem;}
.value{font-size:2rem;margin-top:6px;}
.log{font-family:monospace;font-size:0.9rem;max-height:180px;overflow-y:auto;background:var(--accent);padding:10px;border-radius:8px;}
.status{font-weight:600;display:inline-block;padding:4px 8px;border-radius:8px;color:#fff;transition:0.3s;}
.status.on{background:var(--success);}
.status.off{background:var(--error);}
footer{text-align:center;padding:12px;color:gray;font-size:0.85rem;}
.login-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.85);display:flex;align-items:center;justify-content:center;z-index:999;}
.login-box{background:var(--card);padding:30px;border-radius:14px;width:90%;max-width:380px;text-align:center;box-shadow:0 0 20px rgba(0,0,0,0.5);animation:pop 0.4s ease;}
@keyframes pop{from{transform:scale(0.9);opacity:0;}to{transform:scale(1);opacity:1;}}
.login-box input{width:100%;margin-bottom:12px;padding:10px;border:1px solid var(--accent);border-radius:8px;background:var(--bg);color:var(--fg);}
.profile{display:flex;align-items:center;justify-content:space-between;gap:10px;margin-bottom:10px;}
.profile span{font-weight:600;}
.profile button{padding:4px 8px;border-radius:8px;font-size:0.8rem;}
.alert{font-weight:600;color:#fff;padding:4px 8px;border-radius:6px;display:inline-block;margin-top:4px;}
.alert.temp{background:var(--alert-temp);}
.alert.hum{background:var(--alert-hum);}
@media(max-width:600px){header{flex-direction:column;gap:10px;}.main{grid-template-columns:1fr;}}
</style>
</head>
<body data-theme="dark">

<!-- LOGIN -->
<div id="login" class="login-overlay">
  <div class="login-box">
    <h2 style="color:var(--primary);margin-bottom:15px;">Entrar no Dashboard</h2>
    <input id="email" type="email" placeholder="E-mail">
    <input id="password" type="password" placeholder="Senha">
    <button id="loginBtn" class="btn">Entrar</button>
    <p style="font-size:0.8rem;color:gray;margin-top:8px;">Use qualquer e-mail e senha</p>
  </div>
</div>

<header>
  <h1>üå°Ô∏è Dashboard IoT Pro - DHT11</h1>
  <div>
    <button class="theme-btn" id="themeBtn">üåì</button>
  </div>
</header>

<div class="main">
  <!-- SENSOR CONTROLE -->
  <div class="card">
    <div class="profile">
      <span id="userEmail">Usu√°rio: --</span>
      <button id="logoutBtn">Logout</button>
    </div>
    <h2>Status do Sensor: <span id="sensorStatus" class="status off">OFF</span></h2>
    <button id="toggleSensor" class="btn">Ligar Sensor</button>
    <p>√öltima atualiza√ß√£o: <span id="lastUpdate">--:--:--</span></p>
    <div id="alerts"></div>
  </div>

  <!-- TEMPERATURA -->
  <div class="card">
    <h2>Temperatura Atual</h2>
    <div id="temp" class="value">-- ¬∞C</div>
    <canvas id="tempChart" height="150"></canvas>
  </div>

  <!-- UMIDADE -->
  <div class="card">
    <h2>Umidade Atual</h2>
    <div id="hum" class="value">-- %</div>
    <canvas id="humChart" height="150"></canvas>
  </div>

  <!-- LOGS -->
  <div class="card" style="grid-column:1/-1;">
    <h2>Logs</h2>
    <div id="logs" class="log"></div>
  </div>
</div>

<footer>üåç Dashboard DHT11 via MQTT ‚Ä¢ Profissional e Responsivo</footer>

<script>
  // LOGIN
  const loginOverlay = document.getElementById('login');
  const userEmailEl = document.getElementById('userEmail');
  const logoutBtn = document.getElementById('logoutBtn');
  document.getElementById('loginBtn').onclick = ()=>{
    const email = document.getElementById('email').value;
    const pass = document.getElementById('password').value;
    if(email && pass){
      loginOverlay.style.display = 'none';
      userEmailEl.innerText = `Usu√°rio: ${email}`;
    }else alert('Digite e-mail e senha.');
  };
  logoutBtn.onclick = ()=>location.reload();

  // TEMA
  const themeBtn = document.getElementById('themeBtn');
  themeBtn.onclick = ()=>{
    const theme = document.body.getAttribute('data-theme');
    document.body.setAttribute('data-theme', theme==='dark'?'light':'dark');
  };

  // MQTT
  const brokerUrl = 'wss://test.mosquitto.org:8081';
  const topic = 'home/sensors/dht11';
  const cmdTopic = 'home/sensors/dht11/cmd';
  const client = mqtt.connect(brokerUrl);

  const tempEl = document.getElementById('temp');
  const humEl = document.getElementById('hum');
  const logs = document.getElementById('logs');
  const lastUpdateEl = document.getElementById('lastUpdate');
  const sensorStatusEl = document.getElementById('sensorStatus');
  const toggleBtn = document.getElementById('toggleSensor');
  const alertsEl = document.getElementById('alerts');

  let sensorOn = false;
  const tempLimit = 30; // limite para alerta temperatura
  const humLimit = 70; // limite para alerta umidade

  toggleBtn.onclick = ()=>{
    sensorOn = !sensorOn;
    client.publish(cmdTopic, sensorOn?'ON':'OFF');
    sensorStatusEl.className = sensorOn?'status on':'status off';
    sensorStatusEl.innerText = sensorOn?'ON':'OFF';
    toggleBtn.innerText = sensorOn?'Desligar Sensor':'Ligar Sensor';
    logs.innerHTML += `‚ö° Sensor ${sensorOn?'ligado':'desligado'}<br>`;
    logs.scrollTop = logs.scrollHeight;
  };

  // CHARTS
  const tempCtx = document.getElementById('tempChart').getContext('2d');
  const humCtx = document.getElementById('humChart').getContext('2d');
  const tempData = [], humData = [], labels = [];

  const tempChart = new Chart(tempCtx,{
    type:'line',
    data:{labels,datasets:[{label:'Temperatura (¬∞C)',data:tempData,borderColor:'#00b4d8',backgroundColor:'rgba(0,180,216,0.2)',fill:true,tension:0.4}]},
    options:{responsive:true,scales:{y:{beginAtZero:true}}}
  });
  const humChart = new Chart(humCtx,{
    type:'line',
    data:{labels,datasets:[{label:'Umidade (%)',data:humData,borderColor:'#06d6a0',backgroundColor:'rgba(6,214,160,0.2)',fill:true,tension:0.4}]},
    options:{responsive:true,scales:{y:{beginAtZero:true}}}
  });

  // MQTT EVENTS
  client.on('connect',()=>{
    logs.innerHTML += 'üü¢ Conectado ao broker MQTT<br>';
    client.subscribe(topic);
  });

  client.on('message',(t,message)=>{
    const msg = message.toString();
    logs.innerHTML += `üì• ${msg}<br>`;
    logs.scrollTop = logs.scrollHeight;

    if(msg.includes('TEMP:') && msg.includes('HUM:')){
      const parts = msg.split(',');
      const temp = parseFloat(parts[0].split(':')[1]);
      const hum = parseFloat(parts[1].split(':')[1]);
      const time = new Date().toLocaleTimeString();

      tempEl.innerText = `${temp.toFixed(1)} ¬∞C`;
      humEl.innerText = `${hum.toFixed(1)} %`;
      lastUpdateEl.innerText = time;

      labels.push(time);
      if(labels.length>20){labels.shift();tempData.shift();humData.shift();}
      tempData.push(temp); humData.push(hum);
      tempChart.update(); humChart.update();

      // ALERTAS
      alertsEl.innerHTML = '';
      if(temp>tempLimit){
        alertsEl.innerHTML += `<span class="alert temp">‚ö†Ô∏è Temperatura alta!</span><br>`;
      }
      if(hum>humLimit){
        alertsEl.innerHTML += `<span class="alert hum">‚ö†Ô∏è Umidade alta!</span>`;
      }
    }
  });

  client.on('error',err=>{ logs.innerHTML += `üî¥ Erro MQTT: ${err}<br>`; });
</script>

</body>
</html>
