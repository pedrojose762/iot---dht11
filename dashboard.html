<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>IoT Dashboard Pro - DHT11</title>

<!-- Depend√™ncias -->
<script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">

<style>
:root {
  --primary: #007bff;
  --bg: #f5f6fa;
  --fg: #1a1a1a;
  --card: #ffffff;
  --accent: #e9ecef;
  --success: #28a745;
  --error: #dc3545;
  --warning: #ffc107;
  --radius: 12px;
}

[data-theme="dark"] {
  --bg: #121212;
  --fg: #f1f1f1;
  --card: #1e1e1e;
  --accent: #2b2b2b;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  font-family: 'Poppins', sans-serif;
}

body {
  background: var(--bg);
  color: var(--fg);
  min-height: 100vh;
  transition: background 0.4s, color 0.4s;
}

/* ===== HEADER ===== */
header {
  background: var(--card);
  box-shadow: 0 2px 8px rgba(0,0,0,0.15);
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 15px 25px;
  position: sticky;
  top: 0;
  z-index: 10;
}
header h1 {
  color: var(--primary);
  font-size: 1.5rem;
  font-weight: 600;
}
header .actions {
  display: flex;
  align-items: center;
  gap: 10px;
}
.btn {
  background: var(--primary);
  color: #fff;
  border: none;
  padding: 10px 16px;
  border-radius: var(--radius);
  font-weight: 600;
  cursor: pointer;
  transition: 0.3s;
}
.btn:hover { opacity: 0.9; }
.theme-btn {
  background: none;
  border: 1px solid var(--accent);
  padding: 8px 12px;
  border-radius: var(--radius);
  cursor: pointer;
  color: var(--fg);
  font-weight: 500;
}

/* ===== MAIN ===== */
main {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(340px, 1fr));
  gap: 20px;
  padding: 25px;
}
.card {
  background: var(--card);
  border-radius: var(--radius);
  padding: 20px;
  box-shadow: 0 0 10px rgba(0,0,0,0.1);
  transition: transform 0.3s;
}
.card:hover { transform: translateY(-4px); }
.card h2 {
  font-size: 1.2rem;
  color: var(--primary);
  margin-bottom: 10px;
}
.value {
  font-size: 2.2rem;
  font-weight: 600;
  margin-bottom: 10px;
}
.status {
  display: inline-block;
  padding: 4px 10px;
  border-radius: 8px;
  font-weight: 600;
  color: #fff;
}
.status.on { background: var(--success); }
.status.off { background: var(--error); }
.alert {
  display: inline-block;
  margin-top: 8px;
  padding: 6px 10px;
  border-radius: 8px;
  font-weight: 600;
  color: #fff;
}
.alert.temp { background: var(--warning); }
.alert.hum { background: var(--error); }
.log {
  background: var(--accent);
  border-radius: var(--radius);
  padding: 10px;
  font-family: monospace;
  font-size: 0.9rem;
  max-height: 200px;
  overflow-y: auto;
}

/* ===== LOGIN ===== */
.login-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.75);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 999;
}
.login-box {
  background: var(--card);
  padding: 35px;
  border-radius: var(--radius);
  width: 90%;
  max-width: 380px;
  box-shadow: 0 0 25px rgba(0,0,0,0.3);
  text-align: center;
}
.login-box h2 {
  color: var(--primary);
  margin-bottom: 20px;
}
.login-box input {
  width: 100%;
  padding: 10px;
  margin-bottom: 12px;
  border: 1px solid var(--accent);
  border-radius: var(--radius);
  font-size: 1rem;
  background: var(--bg);
  color: var(--fg);
}
.login-box .btn { width: 100%; }

footer {
  text-align: center;
  padding: 20px;
  font-size: 0.9rem;
  opacity: 0.7;
}
</style>
</head>
<body data-theme="light">

<!-- LOGIN -->
<div id="login" class="login-overlay">
  <div class="login-box">
    <h2>üîê Entrar no Dashboard</h2>
    <input id="email" type="email" placeholder="E-mail">
    <input id="password" type="password" placeholder="Senha">
    <button id="loginBtn" class="btn">Entrar</button>
    <p style="font-size:0.8rem;color:gray;margin-top:10px;">Use um e-mail e senha v√°lidos</p>
  </div>
</div>

<header>
  <h1>üå°Ô∏è IoT Dashboard Pro - DHT11</h1>
  <div class="actions">
    <button id="themeBtn" class="theme-btn">üåó Tema</button>
    <button id="logoutBtn" class="btn">Logout</button>
  </div>
</header>

<main>
  <div class="card">
    <h2>Status do Sensor</h2>
    <p><span id="sensorStatus" class="status off">OFF</span></p>
    <button id="toggleSensor" class="btn" style="margin-top:10px;">Ligar Sensor</button>
    <p style="margin-top:8px;">√öltima atualiza√ß√£o: <span id="lastUpdate">--:--:--</span></p>
    <div id="alerts"></div>
  </div>

  <div class="card">
    <h2>Temperatura Atual</h2>
    <div id="temp" class="value">-- ¬∞C</div>
    <canvas id="tempChart" height="150"></canvas>
  </div>

  <div class="card">
    <h2>Umidade Atual</h2>
    <div id="hum" class="value">-- %</div>
    <canvas id="humChart" height="150"></canvas>
  </div>

  <div class="card" style="grid-column:1/-1;">
    <h2>Logs do Sistema</h2>
    <div id="logs" class="log"></div>
  </div>
</main>

<footer>üì° Dashboard IoT DHT11 ‚Äî MQTT em tempo real ‚Ä¢ 2025</footer>

<script>
/* ===== LOGIN ===== */
const users = [
  {email:"admin@iot.com", password:"123456"},
  {email:"usuario@teste.com", password:"senha2025"}
];
const loginOverlay = document.getElementById('login');
document.getElementById('loginBtn').onclick = () => {
  const email = document.getElementById('email').value.trim();
  const pass = document.getElementById('password').value.trim();
  const user = users.find(u => u.email === email && u.password === pass);
  if (user) {
    loginOverlay.style.display = 'none';
  } else {
    alert("‚ùå E-mail ou senha incorretos!");
  }
};
document.getElementById('logoutBtn').onclick = () => location.reload();

/* ===== TEMA ===== */
const themeBtn = document.getElementById('themeBtn');
themeBtn.onclick = () => {
  const current = document.body.getAttribute('data-theme');
  const next = current === 'light' ? 'dark' : 'light';
  document.body.setAttribute('data-theme', next);
};

/* ===== MQTT ===== */
const client = mqtt.connect('wss://test.mosquitto.org:8081');
const topic = 'senai/iot/dh11';
const cmdTopic = 'senai/iot/dh11';
const logs = document.getElementById('logs');
function logMsg(msg){ logs.innerHTML += msg + '<br>'; logs.scrollTop = logs.scrollHeight; }

client.on('connect',()=>{ logMsg('üü¢ Conectado ao broker MQTT'); client.subscribe(topic); });
client.on('error',err=>logMsg('üî¥ Erro MQTT: '+err));

const tempEl = document.getElementById('temp');
const humEl = document.getElementById('hum');
const sensorStatus = document.getElementById('sensorStatus');
const toggleBtn = document.getElementById('toggleSensor');
const lastUpdate = document.getElementById('lastUpdate');
const alerts = document.getElementById('alerts');
let sensorOn = false;

toggleBtn.onclick = () => {
  sensorOn = !sensorOn;
  client.publish(cmdTopic, sensorOn ? 'ON' : 'OFF');
  sensorStatus.className = sensorOn ? 'status on' : 'status off';
  sensorStatus.innerText = sensorOn ? 'ON' : 'OFF';
  toggleBtn.innerText = sensorOn ? 'Desligar Sensor' : 'Ligar Sensor';
  logMsg(`‚öôÔ∏è Sensor ${sensorOn?'ligado':'desligado'}`);
};

/* ===== GR√ÅFICOS ===== */
const labels=[], tempData=[], humData=[];
const tempChart = new Chart(document.getElementById('tempChart'), {
  type:'line',
  data:{ labels, datasets:[{ label:'Temperatura (¬∞C)', data:tempData, borderColor:'#007bff', backgroundColor:'rgba(0,123,255,0.2)', fill:true, tension:0.4 }]},
  options:{responsive:true, scales:{y:{beginAtZero:true}}}
});
const humChart = new Chart(document.getElementById('humChart'), {
  type:'line',
  data:{ labels, datasets:[{ label:'Umidade (%)', data:humData, borderColor:'#28a745', backgroundColor:'rgba(40,167,69,0.2)', fill:true, tension:0.4 }]},
  options:{responsive:true, scales:{y:{beginAtZero:true}}}
});

/* ===== RECEBENDO DADOS ===== */
client.on('message',(t,msg)=>{
  const text = msg.toString();
  logMsg('üì• ' + text);
  if(text.includes('TEMP:') && text.includes('HUM:')){
    const [tempStr,humStr] = text.split(',');
    const temp = parseFloat(tempStr.split(':')[1]);
    const hum = parseFloat(humStr.split(':')[1]);
    const time = new Date().toLocaleTimeString();

    tempEl.innerText = `${temp.toFixed(1)} ¬∞C`;
    humEl.innerText = `${hum.toFixed(1)} %`;
    lastUpdate.innerText = time;

    labels.push(time);
    if(labels.length>20){labels.shift();tempData.shift();humData.shift();}
    tempData.push(temp); humData.push(hum);
    tempChart.update(); humChart.update();

    alerts.innerHTML = '';
    if(temp > 30) alerts.innerHTML += `<span class="alert temp">‚ö†Ô∏è Temperatura Alta</span>`;
    if(hum > 70) alerts.innerHTML += `<span class="alert hum">‚ö†Ô∏è Umidade Alta</span>`;
  }
});
</script>

</body>
</html>
